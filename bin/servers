#!/bin/bash

# Stop on errors
set -e
set -u


# Sanity check command line options
usage() {
  echo "Usage: $0 (start|restart|stop|prod)"
}

start() {
  (cd ./proxy/ && npm start &> /dev/null) &
  (cd ./www/ && npm start &> /dev/null) &
  (cd ./restApi/ && npm start &> /dev/null) &
  (cd ./mobile/ && ionic serve);
}

prod() {
  (cd ./proxy/ && npm prod &> /dev/null) &
  (cd ./www/ && npm prod &> /dev/null) &
  (cd ./restApi/ && npm prod &> /dev/null);
}

stop() {
  killall node
}

if [ $# -ne 1 ]; then
  usage
  exit 1
fi

# Parse argument.  $1 is the first argument
case $1 in
  "start")
      # Start Servers
      start
    ;;

  "stop")
      stop
    ;;

  "restart")
      start
      stop
    ;;
  *)
    usage
    exit 1
    ;;
esac